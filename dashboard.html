<html>
  <head>
  	<script type="module" crossorigin="use-credentials">
      import './elements/ros/project.js';
    </script>
  </head>
  <body>
    <ros-project id="project"></ros-project>
    <script>
      const $project = document.getElementById("project");
      function onHashChange() {
        const hash = window.location.hash.substr(1);
        const projectId = parseInt(hash, 10);
        $project.gitlabProjectId = projectId;
      }
      onHashChange();
      window.addEventListener("hashchange", onHashChange);
    </script>
  </body>
</html>

<!--
<div id="events"></div>

<div id="debug">
	<hr/>
	<pre id="response"></pre>
</div>

<style>
#debug {
	display: none;
}
th {
	text-align: right;
}
</style>

<script>
const getProject = () => {
	const input = window.location.hash.substr(1);
	if (input.match(/^[A-Za-z\-_0-9]+$/) === null) {
		throw new Error("invalid project");
	}
	return input;	
}


const url = `/api/v4/projects/${getProject()}/events?target=issue&per_page=100`;
fetch(url)
	.then((response) => response.json())
	.then((data) => {
		document.getElementById("response").innerText = JSON.stringify(data, null, 2);
		return data;
	})
	.then((data) => {
		const eventsByDay = {};
		data
		.map((data) => {
			data["created_at"] = new Date(data["created_at"]);
			return data;
		})
		.sort((a, b) => a.created_at.getTime() > b.created_at.getTime())
		.forEach((event) => {
			const currentDay = `${event.created_at.getFullYear()}-${event.created_at.getMonth()+1}-${event.created_at.getDate()}`;
			if (!eventsByDay.hasOwnProperty(currentDay)) {
				eventsByDay[currentDay] = [];
			}
			eventsByDay[currentDay].push(event);
		});

		return eventsByDay;
	})
	.then((eventsByDay) => {
		const $el = document.getElementById("events");
		$el.innerHTML = "";
		Object.entries(eventsByDay).forEach(([day, events]) => {
			console.log(day);
			const currentDay = new Date(day.split("-"));
			const $day = document.createElement("div");
			$day.classList.add("day");

			const $dayHeading = document.createElement("h3");
			$dayHeading.innerText = currentDay.toLocaleDateString();
	
			const $dayEvents = document.createElement("table");
			events.forEach((event) => {
				const $event = document.createElement("tr");

				const $eventTime = document.createElement("th");
				$eventTime.classList.add("time");
				$eventTime.innerText = `${event.created_at.getHours().toString().padStart(2, '0')}:${event.created_at.getMinutes().toString().padStart(2, '0')}`;
				$event.appendChild($eventTime);

				const $eventBody = document.createElement("td");
				$eventBody.innerText = `${event.author_username} has ${event.action_name}`;
				switch (event.action_name) {
					case "commented on":
					case "opened":
						$eventBody.innerText += ` issue ${event.target_title}`;
						break;
				}
				$event.appendChild($eventBody);
				
				$dayEvents.appendChild($event);
			});

			$day.appendChild($dayHeading);
			$day.appendChild($dayEvents);
			$el.appendChild($day);
		});
	});
</script>
-->